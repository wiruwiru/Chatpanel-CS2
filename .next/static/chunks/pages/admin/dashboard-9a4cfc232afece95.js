(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[36],{756:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>b});var r=s(7876),t=s(4232),l=s(9099),i=s(369),d=s(9983),o=s(3397),n=s(3707),c=s(7216),u=s(7446),m=s(2089),f=s(5104),h=s(9567),x=s(2195),p=s(9081),v=s(7271),g=s(4846);function b(){var e;let{t:a}=(0,g.Bd)(),{toast:s}=(0,v.dj)(),[b,j]=(0,t.useState)(null),[N,y]=(0,t.useState)([]),[w,E]=(0,t.useState)(""),[S,R]=(0,t.useState)("user"),[_,O]=(0,t.useState)(!0),[k,U]=(0,t.useState)(null),[C,I]=(0,t.useState)({}),[T,P]=(0,t.useState)({}),[V,A]=(0,t.useState)({IMAGE_URL:"",SERVER_OPTIONS:[]}),F=(0,l.useRouter)(),z=async e=>{try{let a=await fetch("/api/steam/profiles?ids=".concat(e.join(",")));if(!a.ok)throw Error("Failed to fetch Steam profiles");let s=await a.json();I(e=>({...e,...s}))}catch(e){console.error("Error fetching Steam profiles:",e),U("Failed to fetch user profiles. Please try again later.")}},L=async()=>{try{let e=await fetch("/api/admin/authorized-users");if(!e.ok)throw Error("Failed to fetch authorized users");let a=await e.json();y(a.users||[]);let s=a.users.map(e=>e.steam_id);await z(s)}catch(e){console.error("Error fetching authorized users:",e),U("Failed to fetch authorized users. Please try again later.")}},B=async()=>{try{let e=await fetch("/api/admin/config");if(!e.ok)throw Error("Failed to fetch configuration");let a=await e.json();P(a),A({IMAGE_URL:a.IMAGE_URL||"",SERVER_OPTIONS:JSON.parse(a.SERVER_OPTIONS||"[]")})}catch(e){console.error("Error fetching configuration:",e),U("Failed to fetch configuration. Please try again later.")}};(0,t.useEffect)(()=>{!async function(){try{O(!0);let e=await fetch("/api/auth/session");if(!e.ok)throw Error("Failed to fetch user session");let a=await e.json();a.user&&"admin"===a.user.role?(j(a.user),await L(),await B()):F.push("/login")}catch(e){console.error("Error fetching data:",e),U(e.message)}finally{O(!1)}}()},[F]);let q=async e=>{e.preventDefault();try{let e=await fetch("/api/admin/authorized-users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({steamId:w,role:S})});if(e.ok)await L(),E(""),R("user"),s({title:"Success",description:"User added successfully"});else{let a=await e.json();throw Error(a.message||"Failed to add user")}}catch(e){console.error("Error adding user:",e),s({title:"Error",description:e.message,variant:"destructive"})}},G=async e=>{try{let a=await fetch("/api/admin/authorized-users?steamId=".concat(e),{method:"DELETE"});if(a.ok)await L(),s({title:"Success",description:"User removed successfully"});else{let e=await a.json();throw Error(e.message||"Failed to remove user")}}catch(e){console.error("Error removing user:",e),s({title:"Error",description:e.message,variant:"destructive"})}},M=async(e,a)=>{try{let r=await fetch("/api/admin/authorized-users",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({steamId:e,role:a})});if(r.ok)await L(),s({title:"Success",description:"User role updated successfully"});else{let e=await r.json();throw Error(e.message||"Failed to update user role")}}catch(e){console.error("Error updating user role:",e),s({title:"Error",description:e.message,variant:"destructive"})}},$=(e,a)=>{A(s=>({...s,[e]:a}))},J=async e=>{try{let a=V[e];"SERVER_OPTIONS"===e&&(a=JSON.stringify(a));let r=await fetch("/api/admin/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:e,value:a})});if(r.ok)await B(),s({title:"Success",description:"".concat(e," updated successfully")});else{let e=await r.json();throw Error(e.message||"Failed to update configuration")}}catch(e){console.error("Error updating configuration:",e),s({title:"Error",description:e.message,variant:"destructive"})}},X=e=>{A(a=>({...a,SERVER_OPTIONS:a.SERVER_OPTIONS.filter((a,s)=>s!==e)}))},D=(e,a,s)=>{A(r=>({...r,SERVER_OPTIONS:r.SERVER_OPTIONS.map((r,t)=>t===e?{...r,[a]:s}:r)}))};return _?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background",children:(0,r.jsx)(u.A,{className:"h-8 w-8 animate-spin text-primary"})}):k?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background",children:(0,r.jsxs)("div",{className:"text-lg text-destructive",children:[a("common.error"),": ",k]})}):b?(0,r.jsxs)("div",{className:"min-h-screen flex flex-col bg-background text-foreground",children:[(0,r.jsx)(i.A,{}),(0,r.jsx)("div",{className:"container mx-auto px-4 py-24 flex-1",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto bg-card rounded-lg shadow-md p-7 mb-8",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4 mb-6",children:[(0,r.jsxs)(c.eu,{className:"h-16 w-16",children:[(0,r.jsx)(c.BK,{src:b.avatarUrl||"/placeholder-avatar.png",alt:"User Avatar"}),(0,r.jsx)(c.q5,{children:(null===(e=b.displayName)||void 0===e?void 0:e.charAt(0))||"U"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:b.displayName||"User"}),(0,r.jsxs)("p",{className:"text-muted-foreground",children:["(",b.steamId64,")"]})]})]}),(0,r.jsx)("hr",{className:"border-b border-border my-4"}),"admin"===b.role&&(0,r.jsxs)(x.tU,{defaultValue:"users",children:[(0,r.jsxs)(x.j7,{className:"grid w-full grid-cols-2",children:[(0,r.jsx)(x.Xi,{value:"users",children:a("dashboard.authorizedUsers")}),(0,r.jsx)(x.Xi,{value:"config",children:a("dashboard.configuration")})]}),(0,r.jsxs)(x.av,{value:"users",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4",children:a("dashboard.authorizedUsers")}),N.length>0?(0,r.jsx)("ul",{className:"mb-6 space-y-2",children:N.map(e=>{var s,t,l,i;return(0,r.jsxs)("li",{className:"flex justify-between items-center p-2 bg-accent rounded",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsxs)(c.eu,{className:"h-10 w-10",children:[(0,r.jsx)(c.BK,{src:(null===(s=C[e.steam_id])||void 0===s?void 0:s.avatarUrl)||"/placeholder-avatar.png",alt:"".concat((null===(t=C[e.steam_id])||void 0===t?void 0:t.displayName)||"User","'s avatar")}),(0,r.jsx)(c.q5,{children:((null===(l=C[e.steam_id])||void 0===l?void 0:l.displayName)||"U").charAt(0)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium",children:(null===(i=C[e.steam_id])||void 0===i?void 0:i.displayName)||a("dashboard.unknownUser")}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:e.steam_id})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsxs)(n.l6,{value:e.role,onValueChange:a=>M(e.steam_id,a),children:[(0,r.jsx)(n.bq,{className:"w-[45px] xs:w-[100px] sm:w-[120px] md:w-[140px] bg-background/50 backdrop-blur-sm",children:(0,r.jsx)(n.yv,{placeholder:a("dashboard.role")})}),(0,r.jsxs)(n.gC,{children:[(0,r.jsx)(n.eb,{value:"user",children:a("dashboard.user")}),(0,r.jsx)(n.eb,{value:"admin",children:a("dashboard.admin")})]})]}),(0,r.jsx)(d.$,{onClick:()=>G(e.steam_id),variant:"destructive",size:"sm",children:a("dashboard.remove")})]})]},e.steam_id)})}):(0,r.jsx)("p",{className:"mb-4",children:a("dashboard.noAuthorizedUsers")}),(0,r.jsxs)("form",{onSubmit:q,className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)(o.p,{type:"text",value:w,onChange:e=>E(e.target.value),placeholder:a("dashboard.enterSteamID64"),className:"flex-grow",required:!0}),(0,r.jsxs)(n.l6,{value:S,onValueChange:R,children:[(0,r.jsx)(n.bq,{className:"w-[100px]",children:(0,r.jsx)(n.yv,{placeholder:a("dashboard.role")})}),(0,r.jsxs)(n.gC,{children:[(0,r.jsx)(n.eb,{value:"user",children:a("dashboard.user")}),(0,r.jsx)(n.eb,{value:"admin",children:a("dashboard.admin")})]})]})]}),(0,r.jsx)(d.$,{type:"submit",className:"w-full",children:a("dashboard.addUser")})]})]}),(0,r.jsxs)(x.av,{value:"config",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4",children:a("dashboard.configuration")}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"imageUrl",className:"block text-sm font-medium text-gray-700 mb-1",children:a("dashboard.imageUrl")}),(0,r.jsx)(o.p,{id:"imageUrl",type:"text",value:V.IMAGE_URL,onChange:e=>$("IMAGE_URL",e.target.value),placeholder:a("dashboard.enterImageUrl"),className:"w-full"}),(0,r.jsx)(d.$,{onClick:()=>J("IMAGE_URL"),className:"w-full mt-2",children:a("dashboard.updateImageUrl")})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[a("dashboard.serverOptions")," (",a("dashboard.serverOptionsFormat"),")"]}),(0,r.jsx)(p.Zp,{children:(0,r.jsxs)(p.Wu,{className:"pt-6",children:[V.SERVER_OPTIONS.map((e,s)=>(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,r.jsx)(o.p,{type:"text",value:e.label,onChange:e=>D(s,"label",e.target.value),placeholder:a("dashboard.serverName"),className:"flex-grow"}),(0,r.jsx)(o.p,{type:"text",value:e.value,onChange:e=>D(s,"value",e.target.value),placeholder:a("dashboard.serverId"),className:"flex-grow"}),(0,r.jsx)(d.$,{onClick:()=>X(s),variant:"destructive",size:"icon",children:(0,r.jsx)(m.A,{className:"h-4 w-4"})})]},s)),(0,r.jsxs)(d.$,{onClick:()=>{A(e=>({...e,SERVER_OPTIONS:[...e.SERVER_OPTIONS,{label:"",value:""}]}))},variant:"outline",className:"w-full mt-2",children:[(0,r.jsx)(f.A,{className:"mr-2 h-4 w-4"})," ",a("dashboard.addServerOption")]})]})}),(0,r.jsx)(d.$,{onClick:()=>J("SERVER_OPTIONS"),className:"w-full mt-2",children:a("dashboard.updateServerOptions")})]})]})]})]})]})}),(0,r.jsx)(h.A,{})]}):null}},2195:(e,a,s)=>{"use strict";s.d(a,{Xi:()=>n,av:()=>c,j7:()=>o,tU:()=>d});var r=s(7876),t=s(4232),l=s(1592),i=s(8928);let d=l.bL,o=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)(l.B8,{ref:a,className:(0,i.cn)("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",s),...t})});o.displayName=l.B8.displayName;let n=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)(l.l9,{ref:a,className:(0,i.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",s),...t})});n.displayName=l.l9.displayName;let c=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)(l.UC,{ref:a,className:(0,i.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...t})});c.displayName=l.UC.displayName},3397:(e,a,s)=>{"use strict";s.d(a,{p:()=>i});var r=s(7876),t=s(4232),l=s(8928);let i=t.forwardRef((e,a)=>{let{className:s,type:t,...i}=e;return(0,r.jsx)("input",{type:t,className:(0,l.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:a,...i})});i.displayName="Input"},6242:(e,a,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/dashboard",function(){return s(756)}])},7216:(e,a,s)=>{"use strict";s.d(a,{BK:()=>o,eu:()=>d,q5:()=>n});var r=s(7876),t=s(4232),l=s(8194),i=s(8928);let d=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)(l.bL,{ref:a,className:(0,i.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...t})});d.displayName=l.bL.displayName;let o=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)(l._V,{ref:a,className:(0,i.cn)("aspect-square h-full w-full",s),...t})});o.displayName=l._V.displayName;let n=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)(l.H4,{ref:a,className:(0,i.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...t})});n.displayName=l.H4.displayName},9081:(e,a,s)=>{"use strict";s.d(a,{BT:()=>n,Wu:()=>c,ZB:()=>o,Zp:()=>i,aR:()=>d});var r=s(7876),t=s(4232),l=s(8928);let i=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)("div",{ref:a,className:(0,l.cn)("rounded-xl border bg-card text-card-foreground shadow",s),...t})});i.displayName="Card";let d=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)("div",{ref:a,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",s),...t})});d.displayName="CardHeader";let o=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)("div",{ref:a,className:(0,l.cn)("font-semibold leading-none tracking-tight",s),...t})});o.displayName="CardTitle";let n=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)("div",{ref:a,className:(0,l.cn)("text-sm text-muted-foreground",s),...t})});n.displayName="CardDescription";let c=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)("div",{ref:a,className:(0,l.cn)("p-6 pt-0",s),...t})});c.displayName="CardContent",t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)("div",{ref:a,className:(0,l.cn)("flex items-center p-6 pt-0",s),...t})}).displayName="CardFooter"},9567:(e,a,s)=>{"use strict";s.d(a,{A:()=>d});var r=s(7876),t=s(8230),l=s.n(t),i=s(4846);function d(){let{t:e}=(0,i.Bd)();return(0,r.jsx)("footer",{className:"py-6 text-center border-t border-border",children:(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:[(0,r.jsx)(l(),{href:"/",className:"hover:text-primary transition-colors",children:"ChatPanel"})," ",e("footer.copyright")," \xa9 | ",e("footer.designBy")," ",(0,r.jsx)(l(),{href:"https://lucauy.dev",target:"_blank",rel:"nofollow",className:"hover:text-primary transition-colors",children:"Luca."})]})})}}},e=>{var a=a=>e(e.s=a);e.O(0,[808,248,369,636,593,792],()=>a(6242)),_N_E=e.O()}]);